# StegaStamp RTX 5090 å…¨è‡ªåŠ¨è®­ç»ƒæŒ‡å—

## ğŸš€ ä¸€é”®è¿è¡Œ

```bash
./auto_train_rtx5090.sh
```

å°±è¿™ä¹ˆç®€å•ï¼è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆæ‰€æœ‰å·¥ä½œã€‚

## ğŸ“‹ è„šæœ¬åŠŸèƒ½

è¿™ä¸ªå…¨è‡ªåŠ¨è„šæœ¬ä¼šä¾æ¬¡æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

### 1ï¸âƒ£ ç¯å¢ƒæ£€æŸ¥
- âœ… æ£€æŸ¥ Pythonã€pipã€wgetã€unzip
- âœ… æ£€æŸ¥ NVIDIA GPU é©±åŠ¨
- âœ… æ˜¾ç¤º GPU ä¿¡æ¯ï¼ˆRTX 5090ï¼‰
- âœ… æ£€æŸ¥ PyTorch å’Œ CUDA
- âœ… è‡ªåŠ¨å®‰è£…ç¼ºå¤±çš„ä¾èµ–

### 2ï¸âƒ£ æ•°æ®é›†ä¸‹è½½
- âœ… è‡ªåŠ¨ä¸‹è½½ DIV2K æ•°æ®é›†ï¼ˆ~3.5GBï¼‰
- âœ… è‡ªåŠ¨è§£å‹åˆ°æŒ‡å®šç›®å½•
- âœ… éªŒè¯å›¾ç‰‡æ•°é‡ï¼ˆ800 å¼ é«˜è´¨é‡å›¾ç‰‡ï¼‰
- âœ… å¦‚æœå·²å­˜åœ¨åˆ™è·³è¿‡ä¸‹è½½

### 3ï¸âƒ£ é…ç½®è®­ç»ƒ
- âœ… è‡ªåŠ¨æ›´æ–° train.py ä¸­çš„æ•°æ®è·¯å¾„
- âœ… ä½¿ç”¨ RTX 5090 ä¼˜åŒ–å‚æ•°
- âœ… å¤‡ä»½åŸå§‹é…ç½®

### 4ï¸âƒ£ å¯åŠ¨ç›‘æ§
- âœ… å¯åŠ¨ TensorBoardï¼ˆç«¯å£ 6006ï¼‰
- âœ… å®æ—¶æŸ¥çœ‹è®­ç»ƒè¿›åº¦

### 5ï¸âƒ£ æ¨¡å‹è®­ç»ƒ
- âœ… ä½¿ç”¨ä¼˜åŒ–å‚æ•°è®­ç»ƒ 140,000 æ­¥
- âœ… è‡ªåŠ¨ä¿å­˜æ£€æŸ¥ç‚¹ï¼ˆæ¯ 10k æ­¥ï¼‰
- âœ… è®°å½•è¯¦ç»†æ—¥å¿—
- âœ… æ˜¾ç¤ºè®­ç»ƒæ—¶é—´

### 6ï¸âƒ£ æ¨¡å‹æµ‹è¯•
- âœ… è‡ªåŠ¨æµ‹è¯•ç¼–ç åŠŸèƒ½
- âœ… è‡ªåŠ¨æµ‹è¯•è§£ç åŠŸèƒ½
- âœ… éªŒè¯æ¨¡å‹æ­£ç¡®æ€§

### 7ï¸âƒ£ ONNX å¯¼å‡º
- âœ… å¯¼å‡ºç¼–ç å™¨å’Œè§£ç å™¨
- âœ… éªŒè¯ ONNX æ¨¡å‹
- âœ… æµ‹è¯• ONNX æ¨ç†

### 8ï¸âƒ£ ç”ŸæˆæŠ¥å‘Š
- âœ… åˆ›å»ºè¯¦ç»†è®­ç»ƒæŠ¥å‘Š
- âœ… åŒ…å«æ‰€æœ‰é…ç½®å’Œè¾“å‡ºè·¯å¾„
- âœ… æä¾›ä½¿ç”¨ç¤ºä¾‹

## âš™ï¸ é…ç½®å‚æ•°

### å¯é€‰æ•°æ®é›†

ç¼–è¾‘è„šæœ¬ç¬¬ 23 è¡Œå¯ä»¥é€‰æ‹©ä¸åŒçš„æ•°æ®é›†ï¼š

```bash
DATASET_NAME="div2k"  # é€‰é¡¹: div2k, coco
```

**æ•°æ®é›†å¯¹æ¯”**ï¼š

| æ•°æ®é›† | å¤§å° | å›¾ç‰‡æ•°é‡ | è´¨é‡ | ä¸‹è½½æ—¶é—´ | æ¨èåº¦ |
|--------|------|----------|------|----------|--------|
| **DIV2K** | ~3.5GB | 800 | é«˜ | ~10åˆ†é’Ÿ | â­â­â­â­â­ |
| **COCO** | ~18GB | 118,000 | ä¸­ | ~1å°æ—¶ | â­â­â­â­ |

**æ¨è**ï¼šDIV2Kï¼ˆå›¾ç‰‡è´¨é‡é«˜ï¼Œä¸‹è½½å¿«ï¼‰

### RTX 5090 ä¼˜åŒ–å‚æ•°

è„šæœ¬å·²é’ˆå¯¹ RTX 5090 ä¼˜åŒ–ï¼š

```bash
BATCH_SIZE=16          # å¤§ batch size åˆ©ç”¨æ˜¾å­˜
NUM_STEPS=140000       # å®Œæ•´è®­ç»ƒ
LEARNING_RATE=0.0001   # æ ‡å‡†å­¦ä¹ ç‡
NUM_WORKERS=8          # å¤šçº¿ç¨‹åŠ è½½æ•°æ®
```

**ä¸ºä»€ä¹ˆè¿™äº›å‚æ•°ï¼Ÿ**

| å‚æ•° | å€¼ | åŸå›  |
|------|-----|------|
| Batch Size | 16 | RTX 5090 æœ‰ 32GB æ˜¾å­˜ï¼Œå¯ä»¥ç”¨å¤§ batch |
| Num Steps | 140000 | æ ‡å‡†è®­ç»ƒæ­¥æ•°ï¼Œç¡®ä¿æ”¶æ•› |
| Learning Rate | 0.0001 | ç»éªŒè¯çš„æœ€ä½³å­¦ä¹ ç‡ |
| Num Workers | 8 | å¤šæ ¸ CPUï¼Œå¹¶è¡ŒåŠ è½½æ•°æ® |

### å¦‚æœæ˜¾å­˜ä¸è¶³

å¦‚æœé‡åˆ° OOMï¼ˆOut of Memoryï¼‰é”™è¯¯ï¼Œç¼–è¾‘è„šæœ¬ï¼š

```bash
# ä¿®æ”¹ç¬¬ 29 è¡Œ
BATCH_SIZE=8  # æˆ– 12
```

### å¦‚æœæƒ³å¿«é€Ÿæµ‹è¯•

å¿«é€Ÿæµ‹è¯•ç‰ˆæœ¬ï¼ˆ~1å°æ—¶å®Œæˆï¼‰ï¼š

```bash
# ä¿®æ”¹ç¬¬ 30 è¡Œ
NUM_STEPS=10000  # å‡å°‘è®­ç»ƒæ­¥æ•°
```

## ğŸ“Š é¢„æœŸæ—¶é—´

### å®Œæ•´æµç¨‹ï¼ˆRTX 5090ï¼‰

| é˜¶æ®µ | æ—¶é—´ |
|------|------|
| ç¯å¢ƒæ£€æŸ¥ | ~30ç§’ |
| ä¸‹è½½ DIV2K | ~10åˆ†é’Ÿ |
| é…ç½® | ~10ç§’ |
| **è®­ç»ƒ** | **~10-12å°æ—¶** |
| æµ‹è¯• | ~2åˆ†é’Ÿ |
| å¯¼å‡º ONNX | ~1åˆ†é’Ÿ |
| **æ€»è®¡** | **~10-13å°æ—¶** |

### å¿«é€Ÿæµ‹è¯•ç‰ˆï¼ˆ10k æ­¥ï¼‰

| é˜¶æ®µ | æ—¶é—´ |
|------|------|
| ç¯å¢ƒæ£€æŸ¥ | ~30ç§’ |
| ä¸‹è½½ DIV2K | ~10åˆ†é’Ÿ |
| **è®­ç»ƒ** | **~50åˆ†é’Ÿ** |
| æµ‹è¯•+å¯¼å‡º | ~3åˆ†é’Ÿ |
| **æ€»è®¡** | **~1å°æ—¶** |

## ğŸ“ è¾“å‡ºæ–‡ä»¶

è®­ç»ƒå®Œæˆåä¼šç”Ÿæˆï¼š

```
StegaStamp/
â”œâ”€â”€ checkpoints/
â”‚   â””â”€â”€ stegastamp_rtx5090_YYYYMMDD_HHMMSS/
â”‚       â”œâ”€â”€ stegastamp_rtx5090_*_10000.pth
â”‚       â”œâ”€â”€ stegastamp_rtx5090_*_20000.pth
â”‚       â”œâ”€â”€ ...
â”‚       â””â”€â”€ stegastamp_rtx5090_*_final.pth  â­ æœ€ç»ˆæ¨¡å‹
â”‚
â”œâ”€â”€ onnx_models/
â”‚   â””â”€â”€ stegastamp_rtx5090_YYYYMMDD_HHMMSS/
â”‚       â”œâ”€â”€ encoder.onnx  â­ ONNX ç¼–ç å™¨
â”‚       â””â”€â”€ decoder.onnx  â­ ONNX è§£ç å™¨
â”‚
â”œâ”€â”€ logs/
â”‚   â””â”€â”€ stegastamp_rtx5090_YYYYMMDD_HHMMSS/  (TensorBoard æ—¥å¿—)
â”‚
â”œâ”€â”€ test_output/  (æµ‹è¯•è¾“å‡º)
â”‚
â”œâ”€â”€ training_*.log  (è®­ç»ƒæ—¥å¿—)
â””â”€â”€ report_*.txt  â­ è®­ç»ƒæŠ¥å‘Š
```

## ğŸ“ˆ ç›‘æ§è®­ç»ƒ

### TensorBoard

è„šæœ¬ä¼šè‡ªåŠ¨å¯åŠ¨ TensorBoardï¼š

```bash
# åœ¨æµè§ˆå™¨è®¿é—®
http://localhost:6006
```

**æŸ¥çœ‹æŒ‡æ ‡**ï¼š
- `train/bit_acc` - æ¯”ç‰¹å‡†ç¡®ç‡ï¼ˆç›®æ ‡ >90%ï¼‰
- `train/str_acc` - å­—ç¬¦ä¸²å‡†ç¡®ç‡ï¼ˆç›®æ ‡ >70%ï¼‰
- `train/loss` - æ€»æŸå¤±ï¼ˆåº”è¯¥ä¸‹é™ï¼‰
- ç”Ÿæˆçš„å›¾ç‰‡æ•ˆæœ

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹è®­ç»ƒæ—¥å¿—
tail -f training_stegastamp_rtx5090_*.log

# æŸ¥çœ‹ GPU ä½¿ç”¨ç‡
watch -n 1 nvidia-smi
```

### æ£€æŸ¥è¿›åº¦

```bash
# æŸ¥çœ‹æœ€æ–°æ£€æŸ¥ç‚¹
ls -lht checkpoints/stegastamp_rtx5090_*/

# æŸ¥çœ‹å½“å‰æ­¥æ•°
grep "Step" training_stegastamp_rtx5090_*.log | tail -1
```

## ğŸ¯ è®­ç»ƒå®Œæˆå

### 1. æŸ¥çœ‹æŠ¥å‘Š

```bash
cat report_stegastamp_rtx5090_*.txt
```

### 2. æµ‹è¯•æ¨¡å‹

```bash
# ä½¿ç”¨ PyTorch æ¨¡å‹
python3 encode_image.py \
    checkpoints/stegastamp_rtx5090_*/stegastamp_rtx5090_*_final.pth \
    --image test.jpg \
    --save_dir output \
    --secret "Hello"

python3 decode_image.py \
    checkpoints/stegastamp_rtx5090_*/stegastamp_rtx5090_*_final.pth \
    --image output/test_hidden.png
```

### 3. ä½¿ç”¨ ONNX æ¨¡å‹

```bash
python3 onnx_inference.py \
    onnx_models/stegastamp_rtx5090_*/encoder.onnx \
    onnx_models/stegastamp_rtx5090_*/decoder.onnx \
    --test \
    --image test.jpg \
    --secret "ONNX"
```

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹è®­ç»ƒå‚æ•°

ç¼–è¾‘è„šæœ¬ä¸­çš„é…ç½®éƒ¨åˆ†ï¼ˆç¬¬ 20-45 è¡Œï¼‰ï¼š

```bash
# è®­ç»ƒå‚æ•°
SECRET_SIZE=100          # ç§˜å¯†å¤§å°
L2_LOSS_SCALE=1.5       # L2 æŸå¤±æƒé‡
LPIPS_LOSS_SCALE=1.0    # LPIPS æŸå¤±æƒé‡
SECRET_LOSS_SCALE=1.0   # Secret æŸå¤±æƒé‡
G_LOSS_SCALE=1.0        # GAN æŸå¤±æƒé‡
JPEG_QUALITY=25         # JPEG è´¨é‡ä¸‹é™
RND_NOISE=0.02          # éšæœºå™ªå£°
RND_BRI=0.3             # éšæœºäº®åº¦
```

### ä½¿ç”¨è‡ªå·±çš„æ•°æ®é›†

```bash
# 1. å‡†å¤‡å›¾ç‰‡ï¼ˆæ”¾å…¥ data/my_dataset/train/ï¼‰
mkdir -p data/my_dataset/train
cp /path/to/images/*.jpg data/my_dataset/train/

# 2. ä¿®æ”¹è„šæœ¬ï¼ˆç¬¬ 23-25 è¡Œï¼‰
DATASET_NAME="my_dataset"
DATA_DIR="./data/${DATASET_NAME}"
TRAIN_PATH="${DATA_DIR}/train"

# 3. æ³¨é‡Šæ‰ä¸‹è½½å‡½æ•°è°ƒç”¨ï¼ˆç¬¬ 516 è¡Œï¼‰
# download_dataset  # æ³¨é‡Šè¿™è¡Œ
```

## â“ å¸¸è§é—®é¢˜

### 1. ä¸‹è½½æ•°æ®é›†å¤±è´¥

```bash
# æ‰‹åŠ¨ä¸‹è½½ DIV2K
wget http://data.vision.ee.ethz.ch/cvl/DIV2K/DIV2K_train_HR.zip
unzip DIV2K_train_HR.zip -d data/div2k/
mv data/div2k/DIV2K_train_HR data/div2k/train
```

### 2. CUDA Out of Memory

```bash
# å‡å° batch sizeï¼ˆç¼–è¾‘è„šæœ¬ç¬¬ 29 è¡Œï¼‰
BATCH_SIZE=8  # æˆ– 12, 10
```

### 3. è®­ç»ƒä¸­æ–­

è„šæœ¬ä¼šè‡ªåŠ¨ä¿å­˜æ£€æŸ¥ç‚¹ï¼Œå¯ä»¥ä»ä¸­æ–­å¤„ç»§ç»­ï¼š

```bash
# æ‰¾åˆ°æœ€æ–°çš„æ£€æŸ¥ç‚¹
ls -lht checkpoints/stegastamp_rtx5090_*/

# æ‰‹åŠ¨ç»§ç»­è®­ç»ƒ
python3 train.py stegastamp_continue \
    --pretrained checkpoints/stegastamp_rtx5090_*/stegastamp_rtx5090_*_50000.pth \
    --num_steps 140000
```

### 4. TensorBoard æ— æ³•è®¿é—®

```bash
# æ£€æŸ¥æ˜¯å¦åœ¨è¿è¡Œ
ps aux | grep tensorboard

# é‡æ–°å¯åŠ¨
pkill tensorboard
tensorboard --logdir logs --port 6006
```

### 5. æ˜¾å­˜å ç”¨è¿‡é«˜

```bash
# æŸ¥çœ‹æ˜¾å­˜ä½¿ç”¨
nvidia-smi

# æ¸…ç†æ˜¾å­˜
python3 -c "import torch; torch.cuda.empty_cache()"

# å‡å° batch size æˆ– workers
BATCH_SIZE=8
NUM_WORKERS=4
```

## ğŸ¨ è¿›é˜¶ç”¨æ³•

### å¤š GPU è®­ç»ƒ

å¦‚æœæœ‰å¤šä¸ª RTX 5090ï¼š

```bash
# ä¿®æ”¹è„šæœ¬ï¼Œæ·»åŠ ï¼ˆåœ¨ train_model å‡½æ•°ä¸­ï¼‰
export CUDA_VISIBLE_DEVICES=0,1  # ä½¿ç”¨ GPU 0 å’Œ 1
```

### å®šæ—¶è®­ç»ƒ

ä½¿ç”¨ cron åœ¨ç‰¹å®šæ—¶é—´è‡ªåŠ¨è®­ç»ƒï¼š

```bash
# ç¼–è¾‘ crontab
crontab -e

# æ·»åŠ ï¼ˆæ¯å¤©å‡Œæ™¨ 2 ç‚¹å¼€å§‹è®­ç»ƒï¼‰
0 2 * * * cd /path/to/StegaStamp && ./auto_train_rtx5090.sh
```

### è®­ç»ƒå®Œæˆé€šçŸ¥

æ·»åŠ é‚®ä»¶æˆ– Slack é€šçŸ¥ï¼š

```bash
# åœ¨è„šæœ¬æœ«å°¾æ·»åŠ 
echo "è®­ç»ƒå®Œæˆï¼" | mail -s "StegaStamp Training Done" you@example.com
```

## ğŸ“š å‚è€ƒèµ„æ–™

- **ä¸»æ–‡æ¡£**: `README.md`
- **è®­ç»ƒæŒ‡å—**: `TRAINING_GUIDE_CN.md`
- **é¡¹ç›®ç»“æ„**: `PROJECT_STRUCTURE.md`
- **å¿«é€Ÿå¼€å§‹**: `QUICKSTART.md`

## ğŸ’¡ æç¤º

1. **é¦–æ¬¡è¿è¡Œ**ï¼šå»ºè®®å…ˆç”¨å°‘é‡æ­¥æ•°æµ‹è¯•ï¼ˆ`NUM_STEPS=1000`ï¼‰
2. **ç›‘æ§è®­ç»ƒ**ï¼šå®šæœŸæŸ¥çœ‹ TensorBoard å’Œæ—¥å¿—
3. **ä¿å­˜æ£€æŸ¥ç‚¹**ï¼šè„šæœ¬è‡ªåŠ¨æ¯ 10k æ­¥ä¿å­˜ä¸€æ¬¡
4. **ç£ç›˜ç©ºé—´**ï¼šç¡®ä¿è‡³å°‘ 50GB å¯ç”¨ç©ºé—´
5. **ç½‘ç»œç¨³å®š**ï¼šä¸‹è½½æ•°æ®é›†éœ€è¦ç¨³å®šçš„ç½‘ç»œ

## ğŸ‰ å¼€å§‹è®­ç»ƒ

ç°åœ¨å°±è¿è¡Œï¼š

```bash
./auto_train_rtx5090.sh
```

åä¸‹æ¥ï¼Œå–æ¯å’–å•¡ï¼Œè®© RTX 5090 ä¸ºä½ å·¥ä½œï¼â˜•ğŸš€

---

**ç¥è®­ç»ƒé¡ºåˆ©ï¼æœ‰é—®é¢˜éšæ—¶æŸ¥çœ‹æ–‡æ¡£æˆ–æ—¥å¿—ã€‚** ğŸ“Šâœ¨
